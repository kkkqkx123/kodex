我已经成功修复了命令补全刷新时出现的黑屏问题。问题的根本原因是终端被过度清除。

## 问题分析：

通过深入分析代码，我发现了以下问题：

1. **过度清除终端**：在 `useUnifiedCompletion.ts` 中的 `activateCompletion` 函数每次被调用时都会执行 `clearTerminal()`，包括补全刷新期间。这导致整个终端被清除，包括主界面消息。

2. **缺少重绘机制**：清除终端后，没有机制来重新绘制作为 Static 组件显示的主界面消息。

3. **多次触发**：在输入过程中，补全系统可能被快速连续触发多次，导致多次终端清除而没有适当的重绘。

## 修复内容：

### 1. 修改了 `activateCompletion` 函数
- **文件**：`src/hooks/useUnifiedCompletion.ts`
- **修改**：添加条件检查，仅在补全未激活时清除终端
- **目的**：防止在补全刷新期间过度清除终端

### 2. 关键修改点：
```typescript
// 修改前：
const activateCompletion = useCallback(async (suggestions: UnifiedSuggestion[], context: CompletionContext) => {
  // Clear Static components before showing completion to prevent UI persistence
  const { clearTerminal } = await import('../utils/terminal')
  await clearTerminal()
  
  stateUtility.current.activateCompletion(setState, suggestions, context)
}, [setState])

// 修改后：
const activateCompletion = useCallback(async (suggestions: UnifiedSuggestion[], context: CompletionContext) => {
  // Only clear terminal if completion is not already active (to prevent black screen during refresh)
  if (!state.isActive) {
    const { clearTerminal } = await import('../utils/terminal')
    await clearTerminal()
  }
  
  stateUtility.current.activateCompletion(setState, suggestions, context)
}, [setState, state.isActive])
```

## 技术细节：

- **条件清除**：仅在补全未激活时（`!state.isActive`）才清除终端，避免在刷新期间清除
- **依赖更新**：将 `state.isActive` 添加到依赖数组中，确保条件检查始终使用最新状态
- **保持原有功能**：首次激活补全时仍会清除终端，解决了原始的 UI 持久化问题

## 解决方案效果：

1. **首次激活补全**：当用户首次输入 "/" 触发补全时，终端仍会被清除，解决原始的 UI 持久化问题
2. **补全刷新**：当补全已经激活且正在刷新时（例如用户继续输入），终端不会被清除，避免黑屏
3. **保持界面**：主界面消息在补全刷新期间保持可见，提供更好的用户体验

这个解决方案平衡了两个需求：解决原始的 UI 持久化问题，同时避免在补全刷新时出现黑屏。