我已经成功修复了命令补全界面清除不完全的问题。问题的根本原因是 Ink 的 Static 组件未被正确清除。

## 问题分析：

通过深入分析代码，我发现了以下问题：

1. **UI 持久化问题**：当用户使用 "/" 触发命令补全时，原有的主界面 UI（包括消息历史）会持续显示在屏幕上，与新的补全界面重叠。[@,%同理]

2. **Ink Static 组件机制**：在 `MessageRenderer.tsx` 组件中，消息被渲染为 `'static'` 或 `'transient'` 类型。Static 组件设计为在屏幕上持久化，不会在渲染新 UI 元素时自动清除。

3. **清除机制不完整**：原有的 `resetCompletion` 函数只清除了补全建议相关的状态，但没有清除主界面的 Static 组件。

## 修复内容：

### 1. 增强了 `activateCompletion` 函数
- **文件**：`src/hooks/useUnifiedCompletion.ts`
- **修改**：在激活补全前添加了终端清除操作
- **目的**：确保在显示补全界面之前清除所有持久化组件

### 2. 关键修改点：
```typescript
// 修改前：
const activateCompletion = () => {
  setIsCompletionActive(true)
  setCompletionItems([])
  setCompletionQuery('')
}

// 修改后：
const activateCompletion = async () => {
  // 清除终端以移除 Static 组件
  clearTerminal()
  setIsCompletionActive(true)
  setCompletionItems([])
  setCompletionQuery('')
}
```

### 3. 更新了异步处理
- **文件**：`src/hooks/useUnifiedCompletion.ts` 和 `src/hooks/completion/CompletionStateUtility.ts`
- **修改**：
  - 将 `activateCompletion` 和 `handleTabKey` 函数改为异步
  - 更新所有调用点以正确处理异步操作
  - 为异步操作添加了适当的错误处理

### 4. 修复了 TypeScript 兼容性
- **文件**：`src/hooks/completion/CompletionStateUtility.ts`
- **修改**：将 setTimeout 回调改为异步以支持 await 操作
- **目的**：解决 TypeScript 编译错误

## 技术细节：

- **终端清除**：使用现有的 `clearTerminal()` 工具函数（使用 ANSI 转义码 `\x1b[2J\x1b[3J\x1b[H`）
- **渲染顺序**：先清除终端再渲染补全建议，确保在干净的画布上显示
- **异步兼容性**：在整个补全系统中保持异步操作的正确处理
- **状态管理**：维护了现有的补全系统功能，同时解决了 UI 持久化问题

现在当用户输入 "/" 触发命令补全时，整个界面会被正确清除，只显示补全建议，不会再出现旧界面残留的问题。