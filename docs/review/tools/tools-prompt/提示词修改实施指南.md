# 提示词修改实施指南

## 修改文件位置

### Task工具提示词文件
- **文件路径**：`src/tools/TaskTool/prompt.ts`
- **主要函数**：`getPrompt()`
- **修改内容**：PROMPT字符串常量

### TodoWrite工具提示词文件  
- **文件路径**：`src/tools/TodoWriteTool/prompt.ts`
- **主要函数**：`getPrompt()`
- **修改内容**：PROMPT字符串常量

## 修改步骤

### 1. 备份原文件
```bash
# 备份Task工具提示词文件
cp src/tools/TaskTool/prompt.ts src/tools/TaskTool/prompt.ts.backup

# 备份TodoWrite工具提示词文件  
cp src/tools/TodoWriteTool/prompt.ts src/tools/TodoWriteTool/prompt.ts.backup
```

### 2. 修改Task工具提示词

**修改文件**：`src/tools/TaskTool/prompt.ts`

**主要修改内容**：
1. 强化参数格式要求说明
2. 增加错误示例和正确示例对比
3. 加强参数验证规则说明
4. 改进使用场景描述

**具体修改位置**：
```typescript
// 在getPrompt()函数中修改PROMPT字符串
const PROMPT = `
## 工具说明
${DESCRIPTION}

## 必需的输入格式（必须严格遵守）
必须使用完整的JSON对象格式，包含以下三个必需字段：

// ... 具体修改内容参考《Task工具提示词修改方案.md》
`;
```

### 3. 修改TodoWrite工具提示词

**修改文件**：`src/tools/TodoWriteTool/prompt.ts`

**主要修改内容**：
1. 强化todos数组格式要求
2. 增加错误示例和正确示例对比  
3. 加强状态管理规则说明
4. 改进使用场景描述

**具体修改位置**：
```typescript
// 在getPrompt()函数中修改PROMPT字符串
const PROMPT = `
## 工具说明
${DESCRIPTION}

## 必需的输入格式（必须严格遵守）
必须使用完整的JSON对象格式，包含todos数组，每个todo项必须包含所有必需字段：

// ... 具体修改内容参考《TodoWrite工具提示词修改方案.md》
`;
```

### 4. 测试验证

#### 创建测试脚本
```bash
# 创建测试目录
mkdir -p test/tools-prompt
```

#### 测试Task工具
```javascript
// test/tools-prompt/test-task-prompt.js
const { getPrompt } = require('../src/tools/TaskTool/prompt.ts');

async function testTaskPrompt() {
  const prompt = await getPrompt();
  console.log('Task工具提示词长度:', prompt.length);
  console.log('包含subagent_type说明:', prompt.includes('subagent_type'));
  console.log('包含错误示例:', prompt.includes('常见错误示例'));
}

testTaskPrompt();
```

#### 测试TodoWrite工具
```javascript
// test/tools-prompt/test-todowrite-prompt.js  
const { getPrompt } = require('../src/tools/TodoWriteTool/prompt.ts');

async function testTodoWritePrompt() {
  const prompt = await getPrompt();
  console.log('TodoWrite工具提示词长度:', prompt.length);
  console.log('包含todos数组说明:', prompt.includes('todos'));
  console.log('包含ID唯一性说明:', prompt.includes('唯一标识符'));
}

testTodoWritePrompt();
```

### 5. 运行测试
```bash
# 运行测试脚本
node test/tools-prompt/test-task-prompt.js
node test/tools-prompt/test-todowrite-prompt.js
```

## 验证指标

### Task工具验证指标
1. ✅ 提示词包含明确的subagent_type要求
2. ✅ 包含至少3个错误示例和2个正确示例
3. ✅ 包含参数验证规则说明
4. ✅ 包含使用场景最佳实践

### TodoWrite工具验证指标  
1. ✅ 提示词强调todos数组格式要求
2. ✅ 包含ID唯一性验证说明
3. ✅ 包含状态管理规则说明
4. ✅ 包含多个使用示例

## 监控和优化

### 监控方法
1. **日志分析**：监控InputValidationError的出现频率
2. **用户反馈**：收集用户对工具使用体验的反馈
3. **成功率统计**：统计工具调用成功率变化

### 优化策略
1. **A/B测试**：可以尝试不同版本的提示词进行对比
2. **迭代优化**：根据实际使用情况持续调整提示词内容
3. **用户调研**：定期收集用户对提示词清晰度的反馈

## 回滚方案

如果修改后出现意外问题，可以快速回滚：

```bash
# 回滚Task工具提示词
cp src/tools/TaskTool/prompt.ts.backup src/tools/TaskTool/prompt.ts

# 回滚TodoWrite工具提示词
cp src/tools/TodoWriteTool/prompt.ts.backup src/tools/TodoWriteTool/prompt.ts
```

## 注意事项

1. **保持兼容性**：修改提示词时不要改变工具的基本功能
2. **测试充分**：修改后必须进行充分测试
3. **文档更新**：同步更新相关的开发文档
4. **团队沟通**：通知团队成员提示词的修改内容

## 预期时间表

1. **第1天**：修改提示词文件，进行基础测试
2. **第2-3天**：监控工具使用情况，收集初步数据
3. **第1周**：分析使用数据，进行第一次优化调整
4. **第2周**：持续监控，确认修改效果
5. **第3周**：根据数据进一步优化，形成最终版本
