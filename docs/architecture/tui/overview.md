# Kode TUI 架构概述

## 总体架构

Kode的TUI（终端用户界面）采用基于React + Ink的现代化终端应用架构，通过组件化设计实现高度模块化的终端渲染系统。

### 核心架构层级

1. **UI组件层** (`src/components/`)
   - 消息组件 (`messages/`): AssistantTextMessage、Bash输出、命令输出等
   - 交互组件: PromptInput、CustomSelect、权限请求等
   - 基础UI元素: Logo、反馈组件等

2. **屏幕渲染层** (`src/screens/`)
   - REPL主界面: 核心交互界面，集成消息流和输入处理
   - 状态管理: 加载状态、消息队列、API密钥验证

3. **工具基础设施层** (`src/utils/`)
   - 终端控制: 标题设置、清屏、尺寸监听
   - 样式渲染: Markdown格式化、主题系统、语法高亮
   - 消息处理: 系统消息过滤、消息格式化

4. **Hook管理层** (`src/hooks/`)
   - useTerminalSize: 终端尺寸自适应监听
   - 状态管理: 组件状态与终端环境的同步

## 模块划分

### 核心模块

- **REPL界面模块** (`REPL.tsx`): 主交互界面，集成所有TUI组件
- **消息渲染模块** (`messages/`): 支持文本、Bash输出、命令输出等多种消息类型
- **输入处理模块**: 用户输入捕获和处理流水线
- **主题系统模块** (`theme.ts`): 支持明暗主题和色盲友好模式
- **终端适配模块** (`terminal.ts`): 跨平台终端控制接口

### 关键技术栈

- **React + Ink**: 基于React的终端UI框架
- **Marked + cli-highlight**: Markdown渲染和代码语法高亮
- **Chalk**: 终端颜色和样式控制
- **自适应布局**: 基于终端尺寸的动态UI调整

### 架构特点

1. **组件化设计**: 每个UI元素都是独立的React组件
2. **响应式布局**: 自动适应不同终端尺寸
3. **主题系统**: 支持多种颜色主题和可访问性选项
4. **模块化扩展**: 易于添加新的消息类型和UI组件
5. **跨平台兼容**: 支持Windows、macOS、Linux终端环境

## 数据流架构

```
用户输入 → REPL界面 → 消息处理 → AI服务 → 响应渲染 → 终端输出
```

TUI系统通过状态管理和事件驱动机制，实现流畅的终端交互体验。